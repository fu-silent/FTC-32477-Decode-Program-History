# 📚 v2.3 综合使用指南

> **修改代码前务必阅读项目根目录的 `修改指南.md`！**

> **v2.3 特点**：
> - ✨ **无头模式 (Field-Centric)**：按 X 键切换，极大提升驾驶体验。
> - 🔄 **IMU 航向重置**：按 Back 键，随时校准“前向”。
> - ✅ 保留 v2.2 所有功能：双模式底盘、震动反馈、高级发射逻辑等。

## ⚙️ 快速配置

### 1. 修改硬件名称

**文件位置**：
-   单文件版：`TeleOp_All_2_3.java` 中的 `Constants` 类
-   多文件版：`RobotConstants_2_3.java`

**需要修改的硬件** (与 v2.2 相同)
```java
// 底盘
CHASSIS_MOTOR_FRONT_LEFT_NAME = "lf";
// ... 其他电机

// 子系统
SUBSYSTEM_INTAKE_MOTOR_NAME = "intake";
// ... 其他电机

// 传感器
IMU_SENSOR_NAME = "imu";
```

### 2. 修改转速与功率参数 (v2.3)

```java
// 转速档位 (RPM)
SHOOTER_RPM_LONG_RANGE = 1950;      // 超远
SHOOTER_RPM_TRIANGLE_SIDE = 1400;   // 腰部
SHOOTER_RPM_TRIANGLE_BASE = 1200;   // 底部
SHOOTER_RPM_TRIANGLE_TOP = 1625;    // 顶点

// 拾取与装填功率
INTAKE_FORWARD_POWER = 0.9;
LOAD_FORWARD_POWER = 0.75;
```

---

## 🎮 完整按键参考 (v2.3)

| 分类 | 按键 | 功能 | 说明 |
|---|---|---|---|
| **底盘** | 左摇杆↑↓ | 前后移动 | 在无头模式下，始终相对于场地 |
| | 左摇杆← → | 左右平移 | 在无头模式下，始终相对于场地 |
| | 右摇杆← → | 原地旋转 | 保持机器人自身旋转 |
| | **Y 键** | **线性/非线性切换** | 切换摇杆响应曲线 |
| | **X 键** | **有头/无头切换** | 切换为场地参考系或机器人参考系 |
| **导航** | **Back 键** | **重置 IMU 航向** | 将当前车头方向设为新的“前向” |
| | RB (右肩键) | 自动转向 | 自动转向到预设角度 |
| **发射** | D-Pad | 预设转速 | 设置目标转速，手柄震动反馈 |
| | RT (右扳机) | 发射/停止 | 按住启动，松开停止 |
| **拾取/装填** | A/B/LT/LB | 独立控制 | 与 v2.2 逻辑相同 |

---

## ⚡ v2.3 调试流程

> **核心**：先调试底盘的无头模式，再测试其他功能。

### 第一步：调试 IMU 和无头模式

1.  **启动程序**：确保机器人静止，等待 IMU 初始化完成。
2.  **设置前向**：将机器人车头朝向场地“前方”（你希望的前方），然后**按下 Back 键**。此时 IMU 航向被重置为 0。
3.  **切换到无头模式**：**按下 X 键**，观察遥测“驱动模式”变为 `无头 (Field) | ...`。
4.  **测试无头模式**：
    -   向前推左摇杆，机器人应**朝向场地前方**行驶（无论车头朝向）。
    -   向右推左摇杆，机器人应**向场地右侧**平移。
    -   旋转机器人（右摇杆），然后重复以上步骤，确认行驶方向**只与摇杆有关，与车头无关**。
5.  **切换回有头模式**：再次按 X 键，确认机器人恢复为以车头为参考的移动方式。

### 第二步：调试底盘线性/非线性模式
-   按 Y 键，确认遥测中的驱动模式在“线性”和“非线性”之间切换。

### 第三步：测试其他系统
-   参考 v2.2 指南，依次测试拾取、装填、发射档位（带震动）、发射（RT 控制）、自动转向（RB）等功能。这些功能在 v2.3 中没有改变。

---

## 🔧 常见问题和解决方案 (v2.3)

### Q1: 无头模式方向错乱？

**症状**：
-   在无头模式下，向前推摇杆，机器人没有朝预期的前方行驶。

**解决方案**：
1.  **忘记重置 IMU**：在开始使用无头模式前，务必将车头对准场地前方，然后**按下 Back 键**重置航向。
2.  **IMU 安装方向错误**：如果重置后方向依然不正确（例如，前进变成后退），可能是 IMU 的安装方向与代码中的配置不符。
    -   在 `NavigationSystem_2_3.java` 的 `initialize()` 方法中，修改 `RevHubOrientationOnRobot` 的参数。
    -   或者，在 `ChassisDriveSystem_2_3.java` 的 `update()` 方法中，给 `botHeading` 添加一个固定的角度偏移量（例如 `Math.toRadians(navigation.getHeading() + 90)`）。

### Q2: X 或 Y 键切换模式时没有震动？

-   在 `TeleOp_2_3.java` 的主循环中，找到 `if (controlInput.getYPressed())` 和 `if (controlInput.getXPressed())`，在 `{}` 代码块内添加 `controlInput.rumble();` 即可。

### Q3: 遥测信息不显示“无头模式”？

-   确认你正在运行 `TeleOp_2_3.java` 或 `TeleOp_All_2_3.java`。
-   确认 `TelemetryManager_2_3` 或 `TelemetryDisplay` 内部类中的 `displayFullTelemetry` 方法已经更新为 v2.3 的版本，并且 `chassis.getDriveModeName()` 的返回值包含了有头/无头信息。

---

## 📊 遥测显示说明 (v2.3)

### 遥测输出示例

```
========== TeleOp v2.3 ==========
运行时间: 0:00:35.456

--- 底盘与导航 ---
驱动模式: 无头 (Field) | 线性
当前航向: -2.5°
...

--- 按键说明 ---
Y:线性切换 | X:无头切换 | Back:重置IMU
...
```

### 关键指标解读
-   **驱动模式**：显示当前是 **有头/无头** 模式，以及 **线性/非线性** 模式。
-   **当前航向**：IMU 实时航向角，按下 Back 键后会接近 0°。

---

✅ **部署前最终检查**：
-   [ ] 硬件名称已修改
-   [ ] **理解并能在开局时正确使用 Back 键重置 IMU**
-   [ ] **熟悉 Y 和 X 键的功能切换**
-   [ ] 所有 v2.2 的功能依然正常工作

准备完毕，享受无头模式带来的流畅操控体验吧！🚀
