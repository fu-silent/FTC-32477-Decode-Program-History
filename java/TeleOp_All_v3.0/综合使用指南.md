# 📚 v3.0 综合使用指南

> **修改代码前务必阅读项目根目录的 `修改指南.md`！**

> **v3.0 核心特点**：
> - ✨ **多角度航向重置**：D1 D-Pad 快速校准 0°, ±90°, 180° 四个标准角度，**取代 v2.3 的单点 Back 键重置**。
> - 🎯 **专业分工**：明确 D1/D2 职责，D2 专攻精确瞄准和发射系统。
> - 🔧 **IMU 兼容性修复**：内部采用软件偏移量，解决了旧版 SDK 中 `imu.resetYaw(target, unit)` 报错的问题。
> - ✅ **保留 v2.3 核心功能**：无头模式、双模式底盘、震动反馈等。

## ⚙️ 快速配置

### 1. 修改硬件映射名称

**文件位置**：
-   单文件版：`TeleOp_All_3_0_Red.java` 或 `TeleOp_All_3_0_Blue.java` 中的 `Constants` 内部类。

**需要修改的硬件**：请确保以下映射名称与您的 **Robot Configuration** 文件中的名称完全一致。

```java
// 底盘电机 (麦克纳姆轮)
final String CHASSIS_MOTOR_LF = "lf";   // 左前
final String CHASSIS_MOTOR_RF = "rf";   // 右前
final String CHASSIS_MOTOR_LB = "lb";   // 左后
final String CHASSIS_MOTOR_RB = "rb";   // 右后

// 子系统电机
final String MOTOR_INTAKE = "intake";   // 拾取
final String MOTOR_LOAD = "load";       // 装填
final String MOTOR_SHOOTER_1 = "s1";    // 发射器 1
final String MOTOR_SHOOTER_2 = "s2";    // 发射器 2

// 传感器
final String SENSOR_IMU = "imu";        // 惯性测量单元

```

### 2. 修改转速与瞄准角度参数 (v3.0)您可以根据您的机器人性能和比赛策略，在 `Constants` 类中调整预设值。

```java
// 转速档位 (RPM)
final int RPM_LONG = 1950;          // D2 D-Pad Right: 长距离
final int RPM_SIDE = 1400;          // D2 D-Pad Left: 侧边/中距离
final int RPM_BASE = 1200;          // D2 D-Pad Down: 近距离/基础
final int RPM_TOP = 1625;           // D2 D-Pad Up: 顶部/中高转速
final int RPM_REVERSE = 500;        // D2 RB: 发射器反转清理转速

// 自动瞄准角度 (以机器人初始朝向为 0° 的场向角度)
final double TURN_TARGET_TRIANGLE_TOP = 45.0; // D1 A 键瞄准目标
final double TURN_TARGET_FAR = 61.0;          // D1 B 键瞄准目标

```

---

## 🎮 完整按键参考 (v3.0.3)> v3.0 版本实现了**专业分工**
Driver 1 (D1) 专注于底盘移动和导航校准；Driver 2 (D2) 专注于精确瞄准和武器系统。

| 功能分类 | D1 (主驾驶 / 移动) | D2 (副驾驶 / 瞄准) | 说明 |
| --- | --- | --- | --- |
| **移动/平移** | 左摇杆 (移动) | - | 无头模式下，始终按场地方向移动 |
| **旋转** | 右摇杆 (全速转向) | **右摇杆 (0.5x 精确转向)** | D2 接管转向控制，速度减半，用于精细调整瞄准 |
| **航向重置** | **D-Pad ↑/↓/←/→** | - | **重置航向角到 0°/180°/90°/-90°**（用于校准无头模式） |
| **自动瞄准** | **A / B 键** | - | 自动转向到预设的两个目标角度 |
| **模式切换** | X / Y 键 | - | X=有头/无头模式；Y=线性/非线性驱动模式 |
| **发射启停** | - | RT (右扳机) | 按住启动转速，松开停止。**转速达标有震动反馈**。 |
| **发射清理** | - | **RB (右肩键)** | **强制发射器 500 RPM 反转**（高优先级，用于清理卡物） |
| **预设转速** | - | D-Pad | 切换目标 RPM 档位（伴随震动） |
| **拾取进/退** | RT/LB (右扳机/左肩键) | - | 拾取机构控制 |
| **装填进/退** | LT (左扳机) | LB (左肩键) | D1 LT 正向装填；D2 LB 反向清理 |

---

## 🚀 首次运行与调试流程 (v3.0)

### 第一步：调试无头模式和航向重置
1. **启动程序**：运行 `TeleOp_All_Red_3_0` OpMode。
2. **IMU 重置**：将机器人车头对准场地前方（您期望的 0 度方向），按下 **D1 的 D-Pad 上键**。
3. **测试移动**：按下 D1 的 X 键切换到 **无头模式**。向前推左摇杆，机器人应向前（场地前方）移动，无论车头如何旋转。
4. **测试重置**：将机器人转向 90 度，按下 **D1 的 D-Pad 左键**。此时 IMU 读数应接近 90.0°。

### 第二步：测试 D2 精确瞄准与发射清理
1. **D2 精确转向**：D2 使用右摇杆进行转向，观察机器人转向速度是否明显慢于 D1 使用右摇杆时的速度 (0.5x)。
2. **发射清理**：按住 **D2 的 RB 键**，确认发射器电机以 500 RPM 反转，用于清理卡住的物品。

### 第三步：测试自动瞄准
1. 按下 **D1 的 A 键**，确认机器人自动转向到预设的 `45.0°` 目标。
2. 按下 **D1 的 B 键**，确认机器人自动转向到预设的 `61.0°` 目标。

---

## 🔧 常见问题和解决方案 (v3.0)
### Q1: IMU 多角度重置功能报错 'Expected no arguments but found 2'**症状**：

* 代码中尝试调用 `imu.resetYaw(target, unit)` 时，IDE 或运行时报错。

**解决方案**：

* **v3.0.3 版本已从根本上解决此问题。** 程序内部已移除带参数的 `imu.resetYaw()`，转而使用 **软件补偿/偏移量 (`yawOffset`)** 的方法来模拟非零角度重置。请确保使用最新的 v3.0.3 代码版本，无需自行修改 IMU 相关代码。

### Q2: 无头模式方向错乱**症状**：

* 在无头模式下，向前推摇杆，机器人没有朝预期的场地前方行驶。

**解决方案**：

1. **重置航向**：在开始使用无头模式前，务必将车头对准场地前方，然后按下 **D1 的 D-Pad 上键**（重置航向到 0°）。
2. **IMU 安装方向错误**：如果重置后方向依然不正确，可能是 IMU 的安装方向与代码中的配置不符。请在代码的 `Navigation` 类中，检查 `RevHubOrientationOnRobot` 的配置是否与实际 IMU 安装方向匹配。

