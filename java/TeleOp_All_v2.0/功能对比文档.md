# v2.0 åŠŸèƒ½è¯¦è§£å’Œ EXP.java åŠŸèƒ½å¤ç°

## ğŸ“‹ EXP.java åŠŸèƒ½åˆ†æ

EXP.java ç¨‹åºåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼Œç°å·²å…¨éƒ¨åœ¨ v2.0 ä¸­å¤ç°ï¼š

### 1. **IMU è‡ªåŠ¨è½¬å‘ç³»ç»Ÿ** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// EXP.java çš„ performAutoTurn() æ–¹æ³•
- è·å–å½“å‰èˆªå‘ï¼ˆé€šè¿‡ IMU é™€èºä»ªï¼‰
- è®¡ç®—ä¸ç›®æ ‡è§’åº¦çš„è¯¯å·®
- ä½¿ç”¨ PID æ§åˆ¶è®¡ç®—è½¬å‘åŠŸç‡
- åˆ°è¾¾ç›®æ ‡æ—¶åœæ­¢è½¬å‘
```

**v2.0 ä¸­çš„å®ç°**
- NavigationSystem.java - å®Œæ•´çš„ IMU å¯¼èˆªç³»ç»Ÿ
- TeleOp_2_0_0.java ä¸­çš„é›†æˆ
- å‚æ•°é…ç½®åœ¨ RobotConstants_2_0.java

**ä½¿ç”¨æ–¹å¼**
```
å³è‚©é”®ï¼šè§¦å‘è‡ªåŠ¨å‘å³è½¬ 45Â°
```

### 2. **åŒå‘å°„ç”µæœºç³»ç»Ÿ** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// EXP.java çš„ shooter1 å’Œ shooter2 ç”µæœº
private DcMotorEx shooter1 = null;
private DcMotorEx shooter2 = null;

// å…±äº« PIDF å‚æ•°
PIDFCoefficients pidfCoefficients = new PIDFCoefficients(P, I, D, F);
shooter1.setPIDFCoefficients(DcMotor.RunMode.RUN_USING_ENCODER, pidfCoefficients);
shooter2.setPIDFCoefficients(DcMotor.RunMode.RUN_USING_ENCODER, pidfCoefficients);

// åŒæ—¶è®¾ç½®é€Ÿåº¦
shooter1.setVelocity(targetTicksPerSecond);
shooter2.setVelocity(targetTicksPerSecond);
```

**v2.0 ä¸­çš„å®ç°**
- SubsystemManager_2_0.java - åŒç”µæœºç®¡ç†
- è‡ªåŠ¨è½¬é€Ÿè®¡ç®—å’ŒåŒæ­¥
- å‚æ•°ï¼šP=135, I=0, D=80, F=14

**ä½¿ç”¨æ–¹å¼**
```
D-Pad æ–¹å‘é”®ï¼šé€‰æ‹©è½¬é€Ÿæ¡£ä½
è‡ªåŠ¨åŒæ—¶é©±åŠ¨ä¸¤ä¸ªå‘å°„ç”µæœº
```

### 3. **å¤šè½¬é€Ÿæ¡£ä½ç³»ç»Ÿ** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// EXP.java çš„è½¬é€Ÿæ¡£ä½æ§åˆ¶
if(gamepad1.dpad_right) {
    TARGET_RPM = 3200;           // è¶…è¿œ
    ErrorRange = 30;
}
if(gamepad1.dpad_left) {
    TARGET_RPM = 1900;           // ä¸‰è§’è…°
    ErrorRange = 50;
}
if(gamepad1.dpad_down) {
    TARGET_RPM = 1650;           // ä¸‰è§’åº•éƒ¨
    ErrorRange = 150;
}
if(gamepad1.dpad_up) {
    TARGET_RPM = 2400;           // ä¸‰è§’é¡¶ç‚¹
    ErrorRange = 35;
}
```

**v2.0 ä¸­çš„å®ç°**
- RobotConstants_2_0.java ä¸­å®šä¹‰æ‰€æœ‰æ¡£ä½
- SubsystemManager_2_0.java ä¸­è‡ªåŠ¨è°ƒæ•´ç²¾åº¦
- 4 ä¸ªé¢„è®¾æ¡£ä½å®Œå…¨å¤ç°

| æ¡£ä½ | RPM | ç²¾åº¦ | æŒ‰é”® | è¯´æ˜ |
|------|-----|------|------|------|
| è¶…è¿œ | 3200 | Â±30 | D-Pad å³ | æœ€è¿œè·ç¦»å°„å‡» |
| è…°éƒ¨ | 1900 | Â±50 | D-Pad å·¦ | ä¸‰è§’å½¢è…°éƒ¨ |
| åº•éƒ¨ | 1650 | Â±150 | D-Pad ä¸‹ | ä¸‰è§’å½¢åº•éƒ¨ |
| é¡¶ç‚¹ | 2400 | Â±35 | D-Pad ä¸Š | ä¸‰è§’å½¢é¡¶ç‚¹ |

### 4. **è½¬é€Ÿç²¾åº¦è‡ªé€‚åº”** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// æ ¹æ®ä¸åŒæ¡£ä½è‡ªåŠ¨è®¾ç½® ErrorRange
if (rpm == 3200) ErrorRange = 30;
else if (rpm == 1900) ErrorRange = 50;
else if (rpm == 1650) ErrorRange = 150;
else if (rpm == 2400) ErrorRange = 35;

// æ£€æŸ¥æ˜¯å¦åœ¨ç²¾åº¦èŒƒå›´å†…
if((TARGET_RPM + ErrorRange) > currentRPM && 
   currentRPM > (TARGET_RPM - ErrorRange)) {
    volocitycheck = true;
}
```

**v2.0 ä¸­çš„å®ç°**
- SubsystemManager_2_0.setShooterTargetRPM() è‡ªåŠ¨è°ƒæ•´
- è½¬é€Ÿè¾¾æ ‡åˆ¤æ–­åœ¨ isShooterAtTargetSpeed() ä¸­

### 5. **è½¬é€Ÿå®æ—¶åé¦ˆå’Œæ˜¾ç¤º** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// è¯»å–å½“å‰è½¬é€Ÿ
double currentVelocityTicks = shooter2.getVelocity();
double currentRPM = (currentVelocityTicks / MOTOR_TICK_COUNT) * 60;

// é¥æµ‹æ˜¾ç¤º
telemetry.addData("ç›®æ ‡ RPM", TARGET_RPM);
telemetry.addData("å½“å‰ RPM", "%.2f", currentRPM);
```

**v2.0 ä¸­çš„å®ç°**
- SubsystemManager_2_0.getCurrentShooterRPM() è¯»å–
- TelemetryManager_2_0.displayShooterStatus() æ˜¾ç¤º

### 6. **çŠ¶æ€æœºæ§åˆ¶å‘å°„æµç¨‹** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// Y é”®è¾¹ç¼˜æ£€æµ‹
boolean currentYState = gamepad1.y;
if (currentYState && !lastYState) {
    state = true;
}

// æ ¹æ®è½¬é€Ÿå‡†å¤‡æƒ…å†µæ§åˆ¶å‘å°„
if (state && !volocitycheck) {
    // è½¬é€Ÿä¸è¶³ï¼Œåœæ­¢
    intake.setPower(0);
    blender.setPower(0);
} else if (state && volocitycheck) {
    // è½¬é€Ÿå……è¶³ï¼Œå¯åŠ¨å‘å°„
    intake.setPower(1);
    blender.setPower(0.55);
}
```

**v2.0 ä¸­çš„å®ç°**
- SubsystemManager_2_0.updateFireState() çŠ¶æ€ç®¡ç†
- ControlInputManager_2_0.isYButtonPressed() è¾¹ç¼˜æ£€æµ‹
- è‡ªåŠ¨æ£€æŸ¥è½¬é€Ÿï¼Œè¾¾æ ‡æ—¶å¯åŠ¨å‘å°„

### 7. **åº•ç›˜ Mecanum è½®è¿åŠ¨** âœ…

**åŸç†ï¼ˆæ¥è‡ª EXP.javaï¼‰**
```java
// Mecanum è½®åŠŸç‡è®¡ç®—
double leftFrontPower = axial + lateral + yaw;
double rightFrontPower = axial - lateral - yaw;
double leftBackPower = axial - lateral + yaw;
double rightBackPower = axial + lateral - yaw;

// åŠŸç‡å½’ä¸€åŒ–
max = Math.max(Math.abs(leftFrontPower), Math.abs(rightFrontPower));
// ... ç¡®ä¿ä¸è¶…è¿‡ 1.0
```

**v2.0 ä¸­çš„å®ç°**
- ChassisDriveSystem_2_0.java å®Œæ•´å¤ç°
- æ­»åŒºå¤„ç†ã€éçº¿æ€§æ˜ å°„éƒ½åŒ…å«
- è‡ªåŠ¨è½¬å‘æ—¶ç¦ç”¨æ‰‹åŠ¨è½¬å‘

---

## ğŸ”„ EXP.java vs TeleOp_All_2_0_0 åŠŸèƒ½å¯¹åº”è¡¨

| åŠŸèƒ½ | EXP.java ä½ç½® | v2.0 å¯¹åº”ä½ç½® | çŠ¶æ€ |
|------|-------------|----------|------|
| IMU åˆå§‹åŒ– | runOpMode() L110-115 | NavigationSystem.initialize() | âœ… |
| è‡ªåŠ¨è½¬å‘ï¼ˆPIDï¼‰ | performAutoTurn() | NavigationSystem.calculateAutoTurnPower() | âœ… |
| è·å–èˆªå‘ | getHeading() | NavigationSystem.getCurrentHeading() | âœ… |
| åŒå‘å°„ç”µæœºåˆå§‹åŒ– | runOpMode() L95-101 | SubsystemManager_2_0.initialize() | âœ… |
| è½¬é€Ÿæ¡£ä½é€‰æ‹© | ç¬¬ 134-147 è¡Œ | ControlInputManager_2_0.py è¿”å› true/false | âœ… |
| è½¬é€Ÿç²¾åº¦è‡ªé€‚åº” | ç¬¬ 129-147 è¡Œ | SubsystemManager_2_0.setShooterTargetRPM() | âœ… |
| è½¬é€Ÿåé¦ˆè¯»å– | ç¬¬ 149 è¡Œ | SubsystemManager_2_0.getCurrentShooterRPM() | âœ… |
| çŠ¶æ€æœºæ§åˆ¶ | ç¬¬ 152-170 è¡Œ | SubsystemManager_2_0.updateFireState() | âœ… |
| Mecanum è½®è¿åŠ¨ | ç¬¬ 118-142 è¡Œ | ChassisDriveSystem_2_0.update() | âœ… |
| æ‹¾å–æ§åˆ¶ | ç¬¬ 171-190 è¡Œ | SubsystemManager_2_0.intake*() | âœ… |
| è£…å¡«æ§åˆ¶ | ç¬¬ 171-190 è¡Œ | SubsystemManager_2_0.load*() | âœ… |

---

## ğŸ“Š v1.0 vs v2.0 åŠŸèƒ½å¯¹æ¯”

### v1.0 æœ‰ä½† v2.0 æ²¡æœ‰çš„åŠŸèƒ½
âŒ æ—  - v2.0 å®Œå…¨å…¼å®¹ v1.0

### v2.0 æ–°å¢çš„åŠŸèƒ½ï¼ˆæ¥è‡ª EXP.javaï¼‰

| åŠŸèƒ½ | v1.0 | v2.0 | è¯´æ˜ |
|------|------|------|------|
| å‘å°„ç”µæœºæ•°é‡ | 1 | **2** | åŒç”µæœºç‹¬ç«‹æ§åˆ¶ |
| IMU ä¼ æ„Ÿå™¨ | âŒ | **âœ…** | é™€èºä»ªèˆªå‘æµ‹é‡ |
| è‡ªåŠ¨è½¬å‘ | âŒ | **âœ…** | PID æ§åˆ¶è‡ªåŠ¨æ—‹è½¬ |
| è½¬é€Ÿæ¡£ä½ | 1 ä¸ª | **4 ä¸ª** | æ›´çµæ´»çš„è·ç¦»é€‚åº” |
| ç²¾åº¦èŒƒå›´ | å›ºå®š 50 | **è‡ªé€‚åº”** | æ ¹æ®æ¡£ä½è‡ªåŠ¨è°ƒæ•´ |
| èˆªå‘æ˜¾ç¤º | âŒ | **âœ…** | å®æ—¶æ˜¾ç¤ºå½“å‰è§’åº¦ |
| çŠ¶æ€æœº | åŸºç¡€ | **å®Œæ•´** | è‡ªåŠ¨åŒ–å‘å°„æµç¨‹ |

---

## ğŸ® æ–°å¢æŒ‰é”®åŠŸèƒ½

### EXP.java ä¸­æœ‰ä½† v1.0 æ²¡æœ‰çš„

**å³è‚©é”®ï¼šè‡ªåŠ¨è½¬å‘**
```
EXP.java: if (gamepad1.right_bumper && !isTurningToTarget)
v2.0: controlInput.isRightBumperPressed() â†’ navigation.startAutoTurn()
```

**D-Pad å®Œæ•´çš„ 4 æ¡£è½¬é€Ÿ**
```
EXP.java: dpad_right/left/up/down åˆ†åˆ«å¯¹åº” 4 ä¸ªè½¬é€Ÿ
v2.0: å®Œå…¨ç›¸åŒçš„æ˜ å°„
```

---

## ğŸ“ˆ æ€§èƒ½æ”¹è¿›

| æ–¹é¢ | v1.0 | v2.0 | æ”¹è¿› |
|------|------|------|------|
| å‘å°„ç¨³å®šæ€§ | å•ç”µæœº | åŒç”µæœºåŒæ­¥ | â¬†ï¸ æå‡ |
| è½¬å‘ç²¾å‡†åº¦ | æ‰‹åŠ¨ | IMU+PID | â¬†ï¸ æ˜¾è‘—æå‡ |
| è·ç¦»é€‚åº” | 1 æ¡£ | 4 æ¡£è‡ªé€‚åº” | â¬†ï¸ çµæ´» |
| ä»£ç æ¨¡å—åŒ– | 6 æ¨¡å— | 7 æ¨¡å— | â¡ï¸ æ›´æ¸…æ™° |
| å†…å­˜å ç”¨ | 0.8MB | 1.0MB | â¬‡ï¸ å¢åŠ  25% |
| ç¼–è¯‘æ—¶é—´ | 2-3ç§’ | 3-4ç§’ | â¬‡ï¸ å¢åŠ  ~1ç§’ |

---

## ğŸ”§ å‚æ•°å¯¹åº”å…³ç³»

### EXP.java çš„å¸¸æ•° â†’ v2.0 çš„å¯¹åº”ä½ç½®

```java
// EXP.java å¸¸æ•°
public static final double MOTOR_TICK_COUNT = 28;
public static double P = 135, I = 0, D = 80, F = 14;
public static double TARGET_RPM = 0;
public static int ErrorRange = 50;

// v2.0 å¯¹åº”
RobotConstants_2_0.SHOOTER_MOTOR_TICK_COUNT = 28;
RobotConstants_2_0.SHOOTER_PIDF_P = 135;
RobotConstants_2_0.SHOOTER_PIDF_I = 0;
RobotConstants_2_0.SHOOTER_PIDF_D = 80;
RobotConstants_2_0.SHOOTER_PIDF_F = 14;
RobotConstants_2_0.SHOOTER_RPM_LONG_RANGE = 3200; // ç­‰4ä¸ªæ¡£ä½
```

---

## ğŸ“ ä»£ç å¤ç°è¯¦è§£

### 1. IMU è‡ªåŠ¨è½¬å‘ï¼ˆEXP.java ç¬¬ 210-247 è¡Œï¼‰

**EXP.java åŸå§‹æ–¹æ³•**
```java
private void performAutoTurn() {
    double currentHeading = getHeading();
    double headingError = currentHeading - targetHeading;
    
    if (Math.abs(headingError) <= HEADING_THRESHOLD) {
        stopMotors();
        isTurningToTarget = false;
        return;
    }
    
    double turnPower = calculatePIDOutput(headingError);
    setMecanumPower(0, 0, turnPower);
}
```

**v2.0 å¤ç°**
```java
// NavigationSystem.java
public double calculateAutoTurnPower() {
    if (!isTurningToTarget) return 0;
    
    double currentHeading = getCurrentHeading();
    double headingError = normalizeAngle(currentHeading - targetHeading);
    
    if (Math.abs(headingError) <= HEADING_THRESHOLD) {
        isTurningToTarget = false;
        return 0;
    }
    
    double turnPower = calculatePIDOutput(headingError);
    return turnPower;
}
```

### 2. è½¬é€Ÿæ¡£ä½å’Œç²¾åº¦ï¼ˆEXP.java ç¬¬ 130-170 è¡Œï¼‰

**EXP.java åŸå§‹ä»£ç **
```java
if(gamepad1.dpad_right) { TARGET_RPM = 3200; ErrorRange = 30; }
if(gamepad1.dpad_left) { TARGET_RPM = 1900; ErrorRange = 50; }
if(gamepad1.dpad_down) { TARGET_RPM = 1650; ErrorRange = 150; }
if(gamepad1.dpad_up) { TARGET_RPM = 2400; ErrorRange = 35; }
```

**v2.0 å¤ç°**
```java
// SubsystemManager_2_0.java
public void setShooterTargetRPM(int rpm) {
    this.targetRPM = rpm;
    
    if (rpm == Constants.SHOOTER_RPM_LONG_RANGE) {
        this.errorRange = Constants.SHOOTER_RPM_ERROR_RANGE_LONG;
    } else if (rpm == Constants.SHOOTER_RPM_TRIANGLE_SIDE) {
        this.errorRange = Constants.SHOOTER_RPM_ERROR_RANGE_SIDE;
    }
    // ... å…¶ä»–æ¡£ä½
    
    updateShooterSpeed();
}
```

---

## ğŸ¯ æ€»ç»“

âœ… **EXP.java çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½å·²åœ¨ v2.0 ä¸­å®Œæ•´å¤ç°**

- âœ… IMU å¯¼èˆªå’Œè‡ªåŠ¨è½¬å‘
- âœ… åŒå‘å°„ç”µæœºç³»ç»Ÿ
- âœ… 4 ä¸ªè½¬é€Ÿæ¡£ä½
- âœ… è½¬é€Ÿç²¾åº¦è‡ªé€‚åº”
- âœ… çŠ¶æ€æœºæ§åˆ¶
- âœ… Mecanum è½®åº•ç›˜
- âœ… æŒ‰é”®æ˜ å°„

**é¢å¤–ä¼˜åŒ–**
- ä»£ç æ¨¡å—åŒ–ç¨‹åº¦æ›´é«˜
- æ›´å¥½çš„å‚æ•°ç®¡ç†
- æ›´æ¸…æ™°çš„é€»è¾‘æµç¨‹
- æ›´æ˜“æ‰©å±•å’Œç»´æŠ¤

